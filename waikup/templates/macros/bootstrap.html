{% macro with_errors(field) %}
  {% if field.errors %}
    {% set css_class = 'invalid ' + kwargs.pop('class', '') %}
    {{ field(class=css_class, **kwargs) }}
    {% if field.description %}<span class="help">{{ field.description|safe() }}</span>{% endif %}
    <ul class="errors">{% for error in field.errors %}
      <li>{{ error|e }}</li>{% endfor %}</ul>
  {% else %}
    {{ field(**kwargs) }}
    {% if field.description %}<span class="help">{{ field.description|safe() }}</span>{% endif %}
  {% endif %}
{% endmacro %}

{% macro wtfield(field, form_name) %}
  <div class="form-group">
    <label for="{{ form_name }}-{{ field.name }}">{{ field.label }}</label>
    {{ field(class='form-control', id=form_name+'-'+field.name) }}
  </div>
{% endmacro %}

{% macro wtform(form) %}
  <form action="{{ url_for(form.endpoint, redir=page_name|default('index')) }}" id="{{ form.name }}-form" method="POST">
    {{ form.csrf_token() }}
    {% for field in form %}
      {% if field.name != 'csrf_token' %}
        {{ wtfield(field, form.name) }}
      {% endif %}
    {% endfor %}
  </form>
{% endmacro %}
